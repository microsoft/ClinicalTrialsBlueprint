{
 "name": "clinical_trials_matching_core",
 "id": "99e762bf-ed15-4c59-9511-5be0302ee156",
 "scenario_trigger": "clinical_trials_matching_core",
 "description": "clinical_trials_matching_core",
 "active": true,
 "updated": "2023-04-18T09:54:15.472Z",
 "userDisplayName": "Yochai Lehman",
 "code": "{\"version\":3,\"steps\":[{\"id\":\"7a107a8597cc-b1b4a5eef7e89f91-a47f\",\"type\":\"action\",\"label\":\"Init Variables\",\"designer\":{\"xLocation\":6,\"yLocation\":5,\"next\":\"9984e7e32e45-ea107757d2768337-d656\"},\"onInit\":\"scenario.timeStarted = new Date().getTime();\\nscenario.totalQuestionsAsked = 0;\\nscenario.questionIndex = 0;\\nscenario.luis = {};\\nscenario.asyncRes = {};\\n// temp variables for normalization\\nvar locationCity = null;\\nvar locationCountryOrRegion = null;\\nvar locationState = null;\\nvar ageResolution = null;\\nvar condition = null;\\n// for research and improving language model\\nvar notMappedEntities = [];\\n// conversation started with arguments\\nif(scenario.scenarioArgs.entities != null) {\\n    // iterate all LUIS entities and set their values\\n    scenario.scenarioArgs.entities.forEach(ent => {\\n        switch(ent.type) {\\n            case \\\"gender\\\":\\n                scenario.luis.sex = ent.role;\\n                break;\\n            case \\\"builtin.age\\\":\\n                ageResolution = ent.resolution;\\n                break;\\n            case \\\"disease\\\":\\n                condition = ent.entity;\\n                break;\\n            case \\\"builtin.geographyV2.countryRegion\\\":\\n                locationCountryOrRegion = ent.entity;\\n                break;\\n            case \\\"builtin.geographyV2.state\\\":\\n                locationState = ent.entity;\\n                break;\\n            case \\\"builtin.geographyV2.city\\\":\\n                locationCity = ent.entity;\\n                break;\\n            default:\\n                notMappedEntities.push(ent.entity);\\n        }\\n    });\\n}\\n// condition normalization\\nif (condition != null) {\\n    // replace \\\" - \\\" with \\\"-\\\" for luis model entity repair\\n    scenario.luis.condition = condition.replace(\\\" - \\\", \\\"-\\\");\\n}\\n// age normalization\\nif (ageResolution != null) {\\n    switch (ageResolution.unit) {\\n        case \\\"Year\\\":\\n            scenario.luis.age = ageResolution.value;\\n            break;\\n        case \\\"Month\\\":\\n            scenario.luis.age = (+ageResolution.value / 12) + \\\"\\\";\\n            break;\\n        case \\\"Week\\\":\\n            scenario.luis.age = (+ageResolution.value / 52) + \\\"\\\";\\n            break;\\n        case \\\"Day\\\":\\n            scenario.luis.age = (+ageResolution.value / 365) + \\\"\\\";\\n            break;\\n        default:\\n            scenario.luis.age = null;        \\n    }\\n}\\n// location normalization\\nif(locationCountryOrRegion != null || locationState != null || locationCity != null) {\\n    scenario.luis.location = {};\\n    if(locationCountryOrRegion != null) {\\n        scenario.luis.location.countryOrRegion = locationCountryOrRegion;\\n    }\\n    if(locationState != null) {\\n        scenario.luis.location.state = locationState;\\n    }\\n    if(locationCity != null) {\\n        scenario.luis.location.city = locationCity;\\n    }\\n};\\n\\nsession.trace(\\\"LUISSSS\\\" +JSON.stringify(scenario.luis), 0);\"},{\"id\":\"102cf72eca14-b299a2caf0e80fe6-bf31\",\"type\":\"action\",\"label\":\"Assign Values\",\"designer\":{\"xLocation\":6,\"yLocation\":204,\"next\":\"162067c1f357-741c663bd45a2170-d303\"},\"onInit\":\"scenario.consts = scenario.initScenarioResponse.consts;\\n// add explicit log\\nscenario.consts.TRIALS_LOG_LIMIT = 100;\\n\\nscenario.profile = scenario.initScenarioResponse.userProfile;\\nscenario.location = scenario.initScenarioResponse.location\"},{\"id\":\"fb7403c86d6a-1e24272165de9c1b-92f7\",\"type\":\"action\",\"label\":\"Create HDS Request With Demographic conditions\",\"designer\":{\"xLocation\":10,\"yLocation\":380,\"next\":\"7d13692c028c-c62feba5d349bb6e-7959\"},\"onInit\":\"// initialize askedCodes\\nscenario.profile.Info.ClinicalInfo = [];\\n\\n// initialize hdsRequest\\nvar hdsRequest = {};\\nvar configuration = {\\n    ClinicalTrials: {\\n        RegistryFilters : [\\n            {\\n            Sources : [\\\"Clinicaltrials_gov\\\"],\\n            Conditions : [scenario.profile.condition],\\n            FacilityLocations: [{\\n                \\\"State\\\":scenario.location.searchLocationState,\\n                \\\"City\\\":scenario.location.searchLocationCity,\\n                \\\"CountryOrRegion\\\":scenario.location.searchLocationCountryOrRegion\\n            }]\\n            }\\n        ]\\n    },\\n    IncludeEvidence : false,\\n    Verbose: false\\n}\\nvar patients = [];\\npatients[0] = scenario.profile;\\n\\nhdsRequest.id = new Date().getTime().toString();\\n\\nhdsRequest.Configuration = configuration;\\nhdsRequest.Patients = patients;\\n\\nscenario.hdsRequest = hdsRequest;\\n\\n\"},{\"id\":\"8eb78c0e15f8-3aa0bdbacd6795d8-0ac6\",\"type\":\"branch\",\"condition\":\"scenario.trials.length > 0\",\"designer\":{\"xLocation\":252,\"yLocation\":0,\"reverse\":true,\"next\":\"5b4a6c548e07-1673cffccb42b3b4-c522\"},\"label\":\"Trials > 0\",\"targetStepId\":\"c38230cbc10d-7c8058bc6dc833c6-6a00\"},{\"id\":\"6c395b7ffcbf-9a3ac0cb171f8c36-4154\",\"type\":\"statement\",\"designer\":{\"xLocation\":228,\"yLocation\":200,\"next\":\"46c223b11a89-3ac967716fd0b465-98b6\"},\"text\":\"customLocalizedStrings[\\\"CTM/messages/relevantTrialsPrefix\\\"] + \\\" \\\" + scenario.trials.length\",\"stringId\":\"stringId_00902617ba8079bf\",\"label\":\"Relevant trials number\"},{\"id\":\"c38230cbc10d-7c8058bc6dc833c6-6a00\",\"type\":\"branch\",\"condition\":\"scenario.trials.length > scenario.consts.TRIALS_THRESHOLD\",\"designer\":{\"xLocation\":260,\"yLocation\":86,\"reverse\":false,\"next\":\"6c395b7ffcbf-9a3ac0cb171f8c36-4154\"},\"label\":\"Trials > Threshold\",\"targetStepId\":\"57b8d246f882-fccf0daa5e3e5f5e-a939\"},{\"id\":\"162067c1f357-741c663bd45a2170-d303\",\"type\":\"statement\",\"designer\":{\"xLocation\":0,\"yLocation\":300,\"next\":\"fb7403c86d6a-1e24272165de9c1b-92f7\"},\"text\":\"customLocalizedStrings[\\\"CTM/messages/matchingTrials\\\"]\",\"stringId\":\"stringId_a46894ffc1bf4ca9\",\"label\":\"Matching Trials\"},{\"id\":\"c0b338e361df-f9260a30a63543e5-2d46\",\"type\":\"action\",\"label\":\"Create HDS request with Disqualify answers\",\"designer\":{\"xLocation\":740,\"yLocation\":360,\"next\":\"98cd74b3b6e3-4ce71bea1350ec7f-4448\"},\"onInit\":\"var trialIds = scenario.trials.map(trial => trial.id);\\n\\n// initialize qeRequest\\nscenario.hdsRequest = {};\\nvar configuration = {\\n    ClinicalTrials: {\\n    RegistryFilters : [\\n            {\\n                Sources : [\\\"Clinicaltrials_gov\\\"],\\n                Ids:trialIds,\\n            }\\n        ]\\n    },\\n    IncludeEvidence : false,\\n    Verbose: false\\n}\\nvar patients = [];\\npatients[0] = scenario.profile;\\n\\n\\nscenario.hdsRequest.Configuration = configuration;\\nscenario.hdsRequest.Patients = patients;\\n\"},{\"id\":\"22130a4fa790-7398bd4e67a60462-949a\",\"type\":\"action\",\"label\":\"Create Question Args\",\"designer\":{\"xLocation\":1180,\"yLocation\":704,\"next\":\"8cc8d6de3179-a14e044b3f7d5fd5-2360\"},\"onInit\":\"// keeping track for total questions\\r\\nscenario.totalQuestionsAsked++;\\r\\n\\r\\nvar criterion = scenario.HDSAsyncResponse.response.results.patients[0].neededClinicalInfo[scenario.questionIndex];\\r\\n       \\r\\nscenario.questionArgs = {};\\r\\nscenario.questionArgs.question = criterion;\\r\\nscenario.questionArgs.profile = scenario.profile;\\r\\nscenario.questionArgs.questionsNum = scenario.totalQuestionsAsked;\\r\\n\"},{\"id\":\"8cc8d6de3179-a14e044b3f7d5fd5-2360\",\"type\":\"beginScenario\",\"designer\":{\"xLocation\":1008,\"yLocation\":686,\"next\":\"ac3e4757a04f-95c5731ff4cd2f2f-c783\"},\"scenario\":\"clinical_trials_matching_question_generation\",\"variable\":\"questionGenerationResponse\",\"args\":\"scenario.questionArgs\",\"label\":\"Question Generation\"},{\"id\":\"bd61cf721cfb-286941d86a9f1950-d264\",\"type\":\"branch\",\"condition\":\"scenario.questionGenerationResponse == null ||\\r\\nscenario.questionGenerationResponse.length == 0 || \\r\\nscenario.questionGenerationResponse[0].value == null\",\"designer\":{\"xLocation\":726,\"yLocation\":520,\"next\":\"c0b338e361df-f9260a30a63543e5-2d46\"},\"label\":\"Is Don't Know\",\"targetStepId\":\"c7320a2517ea-1c8780d20d47cb35-e956\"},{\"id\":\"c7320a2517ea-1c8780d20d47cb35-e956\",\"type\":\"action\",\"label\":\"Next Question Index\",\"designer\":{\"xLocation\":1540,\"yLocation\":580,\"next\":\"275cf280677e-52bf72c7f8f55bad-ae74\"},\"onInit\":\"scenario.questionIndex = scenario.questionIndex + 1;\"},{\"id\":\"ac3e4757a04f-95c5731ff4cd2f2f-c783\",\"type\":\"action\",\"label\":\"Save answer to profile\",\"designer\":{\"xLocation\":840,\"yLocation\":651,\"next\":\"c7f40688bbe6-46591d81f769a6a1-9d1f\"},\"onInit\":\"scenario.profile.Info.ClinicalInfo.push(...scenario.questionGenerationResponse);\"},{\"id\":\"57b8d246f882-fccf0daa5e3e5f5e-a939\",\"type\":\"action\",\"label\":\"Process disqualify response\",\"designer\":{\"xLocation\":880,\"yLocation\":100,\"next\":\"42b4b5fab0ed-0ff1c03b236e69bd-63c4\"},\"onInit\":\"// update scenario.trialsCountPrev and scenario.trials\\r\\nscenario.trialsCountPrev = scenario.trials.length;\\r\\n\\r\\nscenario.trials = scenario.HDSAsyncResponse.response.results.patients[0].inferences.filter(trial => trial.value == \\\"Eligible\\\");\\r\\n\"},{\"id\":\"d46040c72921-e874ae9773008129-3f14\",\"type\":\"action\",\"label\":\"Init Question Index\",\"designer\":{\"xLocation\":1640,\"yLocation\":480,\"next\":\"275cf280677e-52bf72c7f8f55bad-ae74\"},\"onInit\":\"scenario.questionIndex = 0;\"},{\"id\":\"275cf280677e-52bf72c7f8f55bad-ae74\",\"type\":\"branch\",\"condition\":\"scenario.questionIndex < scenario.HDSAsyncResponse.response.results.patients[0].neededClinicalInfo.length\",\"designer\":{\"xLocation\":1380,\"yLocation\":680,\"next\":\"c0b338e361df-f9260a30a63543e5-2d46\"},\"label\":\"Still have questions\",\"targetStepId\":\"22130a4fa790-7398bd4e67a60462-949a\"},{\"id\":\"c0b5312656d6-cb6b198a64649879-f53d\",\"type\":\"prompt\",\"dataType\":\"[customLocalizedStrings[\\\"CTM/answers/additionalQuestions\\\"], customLocalizedStrings[\\\"CTM/answers/getResults\\\"]]\",\"designer\":{\"xLocation\":1620,\"yLocation\":260,\"next\":\"f3aa06e2bb65-6697b1be21430325-586f\",\"listStyle\":3},\"text\":\"customLocalizedStrings[\\\"CTM/questions/shouldContinueAsking\\\"]\",\"variable\":\"continueAsking\",\"stringId\":\"stringId_b73a4cc0c608505e\",\"choiceType\":\"choice\",\"label\":\"Continue Asking\"},{\"id\":\"42bc07ec8bf1-57c03e2a91e4689e-f6cc\",\"type\":\"branch\",\"condition\":\"scenario.totalQuestionsAsked > 0 && \\r\\n(scenario.trialsCountPrev === scenario.trials.length || \\r\\n scenario.totalQuestionsAsked >= scenario.consts.QUESTIONS_THRESHOLD)\\r\\n\",\"designer\":{\"xLocation\":1554,\"yLocation\":160,\"next\":\"d46040c72921-e874ae9773008129-3f14\"},\"label\":\"Should ask user to continue\",\"targetStepId\":\"c0b5312656d6-cb6b198a64649879-f53d\"},{\"id\":\"04bde4fbe4fd-cde1c2bb3509913a-e268\",\"type\":\"branch\",\"condition\":\"scenario.continueAsking.entity === customLocalizedStrings[\\\"CTM/answers/additionalQuestions\\\"]\",\"designer\":{\"xLocation\":1660,\"yLocation\":324,\"next\":\"46c223b11a89-3ac967716fd0b465-98b6\"},\"label\":\"is Additional questions\",\"targetStepId\":\"d46040c72921-e874ae9773008129-3f14\"},{\"id\":\"ba24c6c14552-29a155c3df1c4f2f-b738\",\"type\":\"branch\",\"condition\":\"(scenario.HDSAsyncResponse.response.results.patients[0].neededClinicalInfo == null || \\r\\n scenario.HDSAsyncResponse.response.results.patients[0].neededClinicalInfo.length === 0)\",\"designer\":{\"xLocation\":1020,\"yLocation\":60,\"reverse\":true,\"next\":\"6b3fdcb8915e-ec4dc8cd89a2ebbd-a086\"},\"label\":\"Is criteria empty\",\"targetStepId\":\"9fb7affe3548-5c84b2220de6ce15-cbda\"},{\"id\":\"b1119c0d3562-c592b7cced67f2b2-e89c\",\"type\":\"statement\",\"designer\":{\"xLocation\":1320,\"yLocation\":60,\"next\":\"efdb922881fd-730358f2fa29dc39-73b0\"},\"text\":\"customLocalizedStrings[\\\"CTM/messages/relevantTrialsPrefix\\\"] + \\\" \\\" + scenario.trials.length\",\"stringId\":\"stringId_00902617ba8079bf\",\"label\":\"Relevant trials number\"},{\"id\":\"6b3fdcb8915e-ec4dc8cd89a2ebbd-a086\",\"type\":\"branch\",\"condition\":\"scenario.trials.length > 0\",\"designer\":{\"xLocation\":1180,\"yLocation\":40,\"next\":\"5b4a6c548e07-1673cffccb42b3b4-c522\"},\"label\":\"Trials > 0\",\"targetStepId\":\"b1119c0d3562-c592b7cced67f2b2-e89c\"},{\"id\":\"efdb922881fd-730358f2fa29dc39-73b0\",\"type\":\"branch\",\"condition\":\"scenario.trials.length > scenario.consts.TRIALS_THRESHOLD\",\"designer\":{\"xLocation\":1452,\"yLocation\":100,\"next\":\"46c223b11a89-3ac967716fd0b465-98b6\"},\"label\":\"Trials > Threshold\",\"targetStepId\":\"42bc07ec8bf1-57c03e2a91e4689e-f6cc\"},{\"id\":\"46c223b11a89-3ac967716fd0b465-98b6\",\"type\":\"action\",\"label\":\"Set trials ids to QeRequest\",\"designer\":{\"xLocation\":232,\"yLocation\":284,\"next\":\"535da28bf288-64b00bc52de35332-887e\"},\"onInit\":\"var trialIds = scenario.trials.map(trial => trial.id);\\r\\n\\r\\n\\r\\n// initialize qeRequest\\r\\nscenario.hdsRequest = {};\\r\\nvar configuration = {\\r\\n    ClinicalTrials: {\\r\\n    RegistryFilters : [\\r\\n        {\\r\\n            Sources : [\\\"Clinicaltrials_gov\\\"],\\r\\n            FacilityLocations: [{\\r\\n                \\\"State\\\":scenario.location.searchLocationState,\\r\\n                \\\"City\\\":scenario.location.searchLocationCity,\\r\\n                \\\"CountryOrRegion\\\":scenario.location.searchLocationCountryOrRegion\\r\\n            }],\\r\\n            Ids:trialIds\\r\\n        }\\r\\n    ]\\r\\n    },\\r\\n    IncludeEvidence : false,\\r\\n    Verbose: true\\r\\n}\\r\\nvar patients = [];\\r\\npatients[0] = scenario.profile;\\r\\n\\r\\n\\r\\nscenario.hdsRequest.Configuration = configuration;\\r\\nscenario.hdsRequest.Patients = patients;\\r\\n\"},{\"id\":\"2333bc1d943a-dbd4cf50e0a91eee-125b\",\"type\":\"action\",\"label\":\"Process trials-details Response\",\"designer\":{\"xLocation\":240,\"yLocation\":540,\"next\":\"e588f774bae0-892987238b37e51d-68d3\"},\"onInit\":\"\\r\\nscenario.startBufferTrials = 0;\\r\\nscenario.endBufferTrials = 50;\\r\\n\\r\\nvar trials = [];\\r\\nscenario.HDSAsyncResponse.response.results.patients[0].inferences.forEach(trial => {\\r\\n    if(trial.value == \\\"Eligible\\\") {\\r\\n        trials.push(trial);\\r\\n    }\\r\\n});\\r\\n\\r\\nscenario.trials = trials;\\r\\nscenario.trialsBuffer = trials.slice(scenario.startBufferTrials, scenario.endBufferTrials);\"},{\"id\":\"7d13692c028c-c62feba5d349bb6e-7959\",\"type\":\"action\",\"label\":\"Log Profile\",\"designer\":{\"xLocation\":8,\"yLocation\":480,\"next\":\"94a3166030bf-1411dd5626526097-06f0\"},\"onInit\":\"session.logCustomEvent('USER_PROFILE', scenario.profile);\"},{\"id\":\"2d52c58f3c9f-311c95e0e7a51ce9-5ed7\",\"type\":\"action\",\"label\":\"Log QE response\",\"designer\":{\"xLocation\":108,\"yLocation\":31,\"next\":\"8eb78c0e15f8-3aa0bdbacd6795d8-0ac6\"},\"onInit\":\"var hdsRequest = {};\\nhdsRequest.trials = scenario.trials.slice(0, scenario.consts.TRIALS_LOG_LIMIT).map(trial => {\\n    return {\\n        \\\"id\\\": trial.id\\n    };\\n});\\nhdsRequest.qeTrialsNum = scenario.trials.length;\\nsession.logCustomEvent('hdsRequest_#1', hdsRequest);\"},{\"id\":\"e588f774bae0-892987238b37e51d-68d3\",\"type\":\"action\",\"label\":\"Log Trials Results\",\"designer\":{\"xLocation\":312,\"yLocation\":648,\"next\":\"ccd45520d814-45f9691a3edb8f42-897f\"},\"onInit\":\"var trialResults = {};\\ntrialResults.totalQuestions = scenario.totalQuestionsAsked;\\ntrialResults.resultTrialsNum = scenario.trials.length;\\ntrialResults.qeTrialsNum = scenario.qeTrials.length;\\ntrialResults.resultTrials = scenario.trials.slice(0, scenario.consts.TRIALS_LOG_LIMIT).map(trial => {\\n    return {\\n        \\\"trialId\\\": trial.id,\\n        \\\"sponsor\\\": trial.leadSponsor\\n    };\\n});\\ntrialResults.secondsSpent = (new Date().getTime() - scenario.timeStarted) / 1000;\\ntrialResults.profile = scenario.profile;\\nsession.logCustomEvent('TRIALS_RESULTS', trialResults);\\n\"},{\"id\":\"f3aa06e2bb65-6697b1be21430325-586f\",\"type\":\"action\",\"label\":\"Log Continue Asking Response\",\"designer\":{\"xLocation\":1340,\"yLocation\":360,\"next\":\"04bde4fbe4fd-cde1c2bb3509913a-e268\"},\"onInit\":\"var continueAskingExtended = {};\\r\\ncontinueAskingExtended.entity = scenario.continueAsking.entity;\\r\\ncontinueAskingExtended.trialsNum = scenario.trials.length;\\r\\nsession.logCustomEvent('USER_CONTINUE_ASKING_RESPONSE', continueAskingExtended);\"},{\"id\":\"c7f40688bbe6-46591d81f769a6a1-9d1f\",\"type\":\"action\",\"label\":\"Log User Answer\",\"designer\":{\"xLocation\":888,\"yLocation\":505,\"next\":\"bd61cf721cfb-286941d86a9f1950-d264\"},\"onInit\":\"var userAnswer = {};\\nuserAnswer.questionsNum = scenario.totalQuestionsAsked;\\nuserAnswer.answer = scenario.questionGenerationResponse;\\nuserAnswer.profile = scenario.profile;\\nsession.logCustomEvent('USER_ANSWER', userAnswer);\"},{\"id\":\"42b4b5fab0ed-0ff1c03b236e69bd-63c4\",\"type\":\"action\",\"label\":\"Log Disqualify Response\",\"designer\":{\"xLocation\":1120,\"yLocation\":220,\"next\":\"ba24c6c14552-29a155c3df1c4f2f-b738\"},\"onInit\":\"var disqualifyResponseExtended = {};\\ndisqualifyResponseExtended.userAnswer = scenario.questionAnswer;\\ndisqualifyResponseExtended.disqualifiedTrialsNum = scenario.trialsCountPrev - scenario.trials.length;\\ndisqualifyResponseExtended.questionsNum = scenario.totalQuestionsAsked;\\nsession.logCustomEvent('DISQUALIFY_RESPONSE', disqualifyResponseExtended);\"},{\"id\":\"9fb7affe3548-5c84b2220de6ce15-cbda\",\"type\":\"statement\",\"designer\":{\"xLocation\":560,\"yLocation\":20,\"next\":\"56dfa186629f-62e11a8c3f24b35f-483f\"},\"text\":\"customLocalizedStrings[\\\"CTM/messages/noAdditionalQuestions\\\"]\",\"stringId\":\"stringId_aa9be14de87b88a7\",\"label\":\"No Additional Questions\"},{\"id\":\"56dfa186629f-62e11a8c3f24b35f-483f\",\"type\":\"branch\",\"condition\":\"scenario.trials && scenario.trials.length > 0\\r\\n\",\"designer\":{\"xLocation\":568,\"yLocation\":80,\"reverse\":true,\"next\":\"5b4a6c548e07-1673cffccb42b3b4-c522\"},\"label\":\"Trials > 0\",\"targetStepId\":\"46c223b11a89-3ac967716fd0b465-98b6\"},{\"id\":\"9984e7e32e45-ea107757d2768337-d656\",\"type\":\"beginScenario\",\"designer\":{\"xLocation\":12,\"yLocation\":100,\"next\":\"102cf72eca14-b299a2caf0e80fe6-bf31\"},\"scenario\":\"clinical_trials_matching_initialization\",\"variable\":\"initScenarioResponse\",\"args\":\"{\\r\\n    luis: scenario.luis\\r\\n}\",\"label\":\"Initialization scenario\"},{\"id\":\"ccd45520d814-45f9691a3edb8f42-897f\",\"type\":\"beginScenario\",\"designer\":{\"xLocation\":534,\"yLocation\":700,\"next\":\"3fbfd01c698f-57bbe31377c17247-99b7\"},\"scenario\":\"clinical_trials_matching_outcome\",\"variable\":\"outcomeScenarioResponse\",\"args\":\"{\\r\\n    \\\"trials\\\": scenario.trialsBuffer,\\r\\n    \\\"error\\\": scenario.error,\\r\\n}\",\"label\":\"Outcome scenario\"},{\"id\":\"5b4a6c548e07-1673cffccb42b3b4-c522\",\"type\":\"action\",\"label\":\"Verify empty trials\",\"designer\":{\"xLocation\":600,\"yLocation\":600,\"next\":\"ccd45520d814-45f9691a3edb8f42-897f\"},\"onInit\":\"// verifying that trials is not null, and empty array\\r\\nscenario.trials = [];\"},{\"id\":\"b06934c57c28-f7976d41b9a5e831-ef13\",\"type\":\"action\",\"label\":\"Set Error\",\"designer\":{\"xLocation\":480,\"yLocation\":600,\"next\":\"ccd45520d814-45f9691a3edb8f42-897f\"},\"onInit\":\"scenario.error = customLocalizedStrings[\\\"CTM/messages/serviceProblem\\\"]\"},{\"id\":\"94a3166030bf-1411dd5626526097-06f0\",\"type\":\"beginScenario\",\"designer\":{\"xLocation\":10,\"yLocation\":580,\"next\":\"7e158957c7b1-3f24b4901d5b0e81-61a1\"},\"scenario\":\"HDSDataConnectionAsync\",\"args\":\"{\\r\\n    \\r\\n    \\\"hdsRequest\\\": scenario.hdsRequest,\\r\\n\\r\\n}\",\"variable\":\"HDSAsyncResponse\",\"label\":\"HDS KG call\"},{\"id\":\"e36aca80cc99-acd2369adbae6253-9b2f\",\"type\":\"action\",\"label\":\"Save answer to profile\",\"designer\":{\"xLocation\":8,\"yLocation\":800,\"next\":\"2d52c58f3c9f-311c95e0e7a51ce9-5ed7\"},\"onInit\":\"const trials = scenario.HDSAsyncResponse.response.results.patients[0].inferences.filter(trial => trial.value == \\\"Eligible\\\");\\r\\n\\r\\nscenario.trials = trials;\\r\\nscenario.trialsCountPrev = trials.length;\\r\\nscenario.qeTrials = scenario.trials;\\r\\nsession.trace(\\\"demographic query has returned:\\\" + trials.length + \\\" trials\\\", 0);\"},{\"id\":\"535da28bf288-64b00bc52de35332-887e\",\"type\":\"beginScenario\",\"designer\":{\"xLocation\":234,\"yLocation\":367,\"next\":\"7be8438a27d8-06408c9c0a7d8317-d9e7\"},\"scenario\":\"HDSDataConnectionAsync\",\"args\":\"{\\r\\n    \\r\\n    \\\"hdsRequest\\\": scenario.hdsRequest,\\r\\n\\r\\n}\",\"variable\":\"HDSAsyncResponse\",\"label\":\"HDS get details\"},{\"id\":\"51c08ae269fd-67da30d199aab861-fbb4\",\"type\":\"beginScenario\",\"designer\":{\"xLocation\":820,\"yLocation\":180,\"next\":\"2d44b90502ae-fa18c1ad79f2c422-70ce\"},\"scenario\":\"HDSDataConnectionAsync\",\"args\":\"{\\r\\n    \\r\\n    \\\"hdsRequest\\\": scenario.hdsRequest,\\r\\n\\r\\n}\",\"variable\":\"HDSAsyncResponse\",\"label\":\"HDS filter trials by answers\"},{\"id\":\"98cd74b3b6e3-4ce71bea1350ec7f-4448\",\"label\":\"Wait\",\"type\":\"wait\",\"designer\":{\"xLocation\":788,\"yLocation\":280,\"next\":\"51c08ae269fd-67da30d199aab861-fbb4\"},\"time\":\"1000\"},{\"id\":\"7e158957c7b1-3f24b4901d5b0e81-61a1\",\"type\":\"branch\",\"condition\":\"scenario.HDSAsyncResponse.error\",\"designer\":{\"xLocation\":12,\"yLocation\":700,\"next\":\"e36aca80cc99-acd2369adbae6253-9b2f\"},\"label\":\"Data connection error\",\"targetStepId\":\"b06934c57c28-f7976d41b9a5e831-ef13\"},{\"id\":\"2d44b90502ae-fa18c1ad79f2c422-70ce\",\"type\":\"branch\",\"condition\":\"scenario.HDSAsyncResponse.error\",\"designer\":{\"xLocation\":660,\"yLocation\":146,\"next\":\"57b8d246f882-fccf0daa5e3e5f5e-a939\"},\"targetStepId\":\"b06934c57c28-f7976d41b9a5e831-ef13\"},{\"id\":\"7be8438a27d8-06408c9c0a7d8317-d9e7\",\"type\":\"branch\",\"condition\":\"scenario.HDSAsyncResponse.error\",\"designer\":{\"xLocation\":352,\"yLocation\":460,\"next\":\"2333bc1d943a-dbd4cf50e0a91eee-125b\"},\"targetStepId\":\"b06934c57c28-f7976d41b9a5e831-ef13\"},{\"id\":\"2412a4a0f767-8864426f06b0e431-2fd6\",\"type\":\"yesnoprompt\",\"dataType\":\"boolean\",\"designer\":{\"xLocation\":332,\"yLocation\":811,\"next\":\"7dee4d8167e1-2d77369badb06d94-dbdb\"},\"text\":\"Would you like to see more trials? \",\"variable\":\"moreTrials\",\"stringId\":\"stringId_7ada6941a91ec95d\",\"targetStepId\":\"c6c976ea1eb4-c7e7f93d7b086a66-484e\"},{\"id\":\"c6c976ea1eb4-c7e7f93d7b086a66-484e\",\"type\":\"action\",\"label\":\"Process trials-details Response\",\"designer\":{\"xLocation\":240,\"yLocation\":760,\"next\":\"ccd45520d814-45f9691a3edb8f42-897f\"},\"onInit\":\"\\r\\nscenario.startBufferTrials += 50;\\r\\nscenario.endBufferTrials += 50;\\r\\nscenario.trialsBuffer = scenario.trials.slice(scenario.startBufferTrials, scenario.endBufferTrials);\\r\\n\\r\\n\\r\\n\"},{\"id\":\"3fbfd01c698f-57bbe31377c17247-99b7\",\"type\":\"branch\",\"condition\":\"!scenario.error && scenario.trials.length > scenario.startBufferTrials + 50\",\"designer\":{\"xLocation\":534,\"yLocation\":807,\"next\":\"7dee4d8167e1-2d77369badb06d94-dbdb\"},\"label\":\"Data connection error && there are more trials\",\"targetStepId\":\"2412a4a0f767-8864426f06b0e431-2fd6\"},{\"id\":\"7dee4d8167e1-2d77369badb06d94-dbdb\",\"type\":\"statement\",\"designer\":{\"xLocation\":420,\"yLocation\":912},\"text\":\"customLocalizedStrings[\\\"CTM/messages/EndSession\\\"]\",\"stringId\":\"stringId_a46894ffc1bf4ca9\",\"label\":\"End session\"}],\"breaking\":false,\"interrupting\":false,\"returningMessage\":\"\"}"
}